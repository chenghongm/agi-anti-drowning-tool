/* ============================================================
   1. 核心折叠逻辑 (保留 1.0 百叶窗效果)
   ============================================================ */
/* --- 1. 核心折叠：修正 pointer-events 否则无法触发 hover --- */
[data-wb-role="mid"],
[data-wb-role="end"] {
    max-height: 48px !important;
    opacity: 0.2;
    overflow: hidden;
    filter: grayscale(1);
    transition: all 0.4s ease;
    /* 修正：必须改为 auto，否则 JS 监听不到 mouseenter */
    pointer-events: auto !important; 
    cursor: zoom-in;
}

/* 延时展开 */
.wb-expanded {
    max-height: 2000px !important;
    opacity: 1 !important;
    filter: none !important;
    pointer-events: auto !important;
    background-color: rgba(16, 163, 127, 0.7) !important; /* 展开时添加淡绿色背景 */
}

/* ============================================================
   2. Start Node 特殊处理 (根据你的新需求：完全隐藏)
   ============================================================ */
/* --- 2. 只有正式 Start 才折叠，Pending(虚线)不折叠 --- */
[data-wb-role="start"] {
    height: auto !important;
    min-height: 24px !important;
    overflow: visible !important;
}

/* 彻底隐藏 Start Node 的原始内容 */
[data-wb-role="start"] > *:not(.wb-branch-group) {
    display: none !important;
}

/* ============================================================
   3. Pending 待定状态 (虚线绿框)
   ============================================================ */
[data-wb-pending="true"] {
    border: 2px dashed #4CAF50 !important;
    background-color: rgba(144, 238, 144, 0.05) !important;
    max-height: none !important; /* 确保不被折叠 */
    opacity: 1 !important;
    filter: none !important;
}
[data-wb-pending="true"] .wb-branch-btn[data-action="start"] {
    background-color: #4CAF50 !important;
    color: white !important;
    opacity: 1 !important;
}

/* ============================================================
   4. S/E/R 按钮组 UI (确保悬浮且不消失)
   ============================================================ */
.wb-branch-group {
    display: flex !important;
    position: absolute !important;
    top: -20px !important;
    left: 10px !important;
    z-index: 10000 !important;
    gap: 4px !important;
    background: #ffffff !important;
    padding: 3px 6px !important;
    border: 1px solid #4CAF50 !important;
    border-radius: 6px !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
}

/* Grok (x.ai) tweak: pull buttons into the left gutter for easier visibility */
.wb-host-grok .wb-branch-group {
    left: -62px !important;
}

/* Grok (x.ai) small screens */
@media (max-width: 640px) {
    .wb-host-grok .wb-branch-group {
        left: -12px !important;
    }
}

.wb-branch-btn {
    font-size: 11px !important;
    font-weight: 800 !important;
    padding: 2px 6px !important;
    border: 1px solid #ddd !important;
    border-radius: 4px !important;
    cursor: pointer !important;
}

/* 按钮状态颜色 */
.wb-branch-btn[data-action="start"] { color: #2e7d32 !important; }
.wb-branch-btn[data-action="end"]   { color: #1565c0 !important; }
.wb-branch-btn[data-action="remove"] { color: #d32f2f !important; }

/* 禁用态：灰色+删除线 */
.wb-branch-btn:disabled {
    color: #bbb !important;
    background-color: #f0f0f0 !important;
    opacity: 0.6 !important;
    text-decoration: line-through !important;
    cursor: not-allowed !important;
}

/* ============================================================
   5. 代码块独立控制 & 手机端导航 (完全保留)
   ============================================================ */
.wb-code-minimized {
    max-height: 100px !important;
    overflow: hidden;
    position: relative;
    border-bottom: 2px solid #ff9800 !important;
}
.wb-code-minimized::after {
    content: "CODE COLLAPSED";
    position: absolute; bottom: 0; width: 100%;
    text-align: center; background: rgba(0,0,0,0.5); color: white; font-size: 10px;
}

#wb-nav-panel {
    position: fixed; right: 10px; top: 50%; transform: translateY(-50%);
    z-index: 10000; display: flex; flex-direction: column; gap: 8px;
}
.wb-nav-dot {
    width: 32px; height: 32px; background: rgba(16, 163, 127, 0.7);
    color: white; border-radius: 50%; display: flex; align-items: center; 
    justify-content: center; font-size: 12px; backdrop-filter: blur(4px);
    cursor: pointer;
}

/* 基础状态：允许平滑过渡 */
pre {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    border-bottom: 2px solid transparent;
}

/* 状态 A: 隐藏模式 (全局开启或手动最小化) */
body.wb-global-code-hide pre,
pre.wb-code-minimized {
    max-height: 80px !important; /* 更紧凑的高度 */
    opacity: 0.4 !important;    /* 降低透明度，类似 message block */
    overflow: hidden !important;
    filter: grayscale(0.8);      /* 稍微去色，减少视觉干扰 */
    cursor: zoom-in;
    
    /* 核心：Blur Out 虚化边缘 */
    mask-image: linear-gradient(to bottom, black 30%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 30%, transparent 100%);
    
    border-bottom: 2px solid #10a37f !important; /* 底部绿色装饰线提醒有内容 */
}

/* 状态 B: 展开模式 (当消息被 Hover 时自动联动) */
article.wb-expanded pre,
pre.wb-code-expanded {
    max-height: 5000px !important; /* 足够大的高度 */
    opacity: 1 !important;
    filter: none !important;
    mask-image: none !important;
    -webkit-mask-image: none !important;
    border-bottom: 2px solid transparent !important;
}

/* 适配：如果代码块在 Start Node 里，默认不显示（因为内容被 display: none 了） */
[data-wb-role="start"] pre {
    display: none !important;
}
